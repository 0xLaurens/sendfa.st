---
export const prerender = false;
import Layout from "../layouts/Layout.astro"
import Navbar from "../components/Navbar.astro";
import {Image} from 'astro:assets';
import Toaster from "../components/Toaster.svelte"
---

<Layout title="Sendfast • Register">
    <section class="bg-base-200 overflow-hidden min-h-screen" id="register">
        <Navbar/>
        <div class="py-24 px-8 max-w-5xl mx-auto ">
            <div class="mx-auto relative max-w-lg w-full">
                <div class="rounded-2xl p-6 shadow-sm bg-base-100">
                    <div class="relative flex flex-col h-full gap-5 lg:gap-8 z-10 p-8 rounded-lg">
                        <div class="flex flex-wrap gap-2">
                            <div class="flex flex-col justify-end mb-[4px] text-lg "><p class="relative"><span
                                    class="absolute bg-base-content h-[1.5px] inset-x-0 top-[53%]"></span><span
                                    class="text-base-content/80"></span></p></div>
                            <p class="text-5xl tracking-tight font-black">Create an account</p>
                            <div class="flex flex-col justify-end mb-[4px]"><p
                                    class="text-xs text-base-content/60 uppercase font-semibold">
                            </p></div>
                        </div>


                        <form action="/api/auth/register" method="post">
                            <label class="form-control">
                                <span class="label">Username</span>
                                <input placeholder="username" class="input input-bordered" name="username">
                            </label>
                            <label class="form-control">
                                <span class="label">Email</span>
                                <input placeholder="example@mail.com" class="input input-bordered" name="email">
                            </label>

                            <label class="form-control">
                                <span class="label">Password</span>
                                <input placeholder="•••••••" type="password" class="input input-bordered"
                                       name="password">
                            </label>
                            <div class="space-y-2 mt-10">
                                <button type="submit" class="btn btn-primary w-full">
                                    Register
                                </button>
                                <button class="btn btn-neutral w-full" value="google" name="provider" type="submit">
                                    Register with Google
                                    <Image loading="eager" alt="google logo" height="50" width="50" class="h-5 w-5"
                                           src="/google.png"/>
                                </button>
                                <p>Already have an account? <a href="/signin"
                                                               class="link link-primary link-hover">Login</a>
                                </p>
                            </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </section>
</Layout>

<script>
    import {addToast} from "../lib/toast";

    document.getElementById('register').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target as HTMLFormElement;
        const formData = new FormData(form);
        try {
            const res = await fetch(form.action, {
                method: form.method,
                body: JSON.stringify(Object.fromEntries(formData)),
            });
            const data = await res.json();
            console.log(data);

            if (!res.ok) return addToast({
                description: data.error, id: Date.now(), title: "Error", type: 'error'
            });

            addToast({
                description: "Registration successful", id: Date.now(), title: "Success", type: 'success'
            });

        } catch (error) {
            console.log(error);
        }
    });
</script>